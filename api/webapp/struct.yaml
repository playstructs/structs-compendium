# Webapp Struct API Endpoints

**Version**: 1.1.0  
**Category**: webapp  
**Entity**: Struct  
**Base URL**: ${webappBaseUrl} (default: http://localhost:8080)  
**Last Updated**: January 1, 2026

---

## v0.8.0-beta Notes

**Struct Lifecycle Changes** (âœ… Verified):
- **Destroyed Field**: Struct queries filter out destroyed structs (`is_destroyed = false`). Destroyed structs are not returned in API responses, consistent with StructSweepDelay behavior (destroyed structs persist for 5 blocks in database but are filtered from queries).
- **StructSweepDelay**: Destroyed structs persist for 5 blocks before being fully removed from database
- **Struct Type Fields**: Struct type endpoint includes `cheatsheet_details` and `cheatsheet_extended_details` fields (via `SELECT * FROM struct_type`)

**See**: `reviews/webapp-review-findings.md` for code review findings

---

## Endpoints

endpoints:
  - id: "webapp-struct-by-player"
    method: "GET"
    path: "/api/struct/player/{player_id}"
    description: "Get structs by player ID"
    category: "webapp"
    entity: "Struct"
    baseUrl: "${webappBaseUrl}"
    parameters:
      - name: "player_id"
        type: "string"
        required: true
        format: "player-id"
        description: "Player identifier"
    response:
      schema: "schemas/entities.json#/definitions/Struct"
      contentType: "application/json"
    example:
      request: "GET http://localhost:8080/api/struct/player/1-11"
      response: |
        [
          {
            "id": "5-1",
            "structTypeId": 14,
            "owner": "1-11",
            "locationId": "2-1",
            "health": 100
          }
        ]

  - id: "webapp-struct-by-planet"
    method: "GET"
    path: "/api/struct/planet/{planet_id}"
    description: "Get structs on planet"
    category: "webapp"
    entity: "Struct"
    baseUrl: "${webappBaseUrl}"
    parameters:
      - name: "planet_id"
        type: "string"
        required: true
        format: "planet-id"
        description: "Planet identifier"
    response:
      schema: "schemas/entities.json#/definitions/Struct"
      contentType: "application/json"
    example:
      request: "GET http://localhost:8080/api/struct/planet/2-1"
      response: |
        [
          {
            "id": "5-1",
            "structTypeId": 14,
            "owner": "1-11",
            "locationId": "2-1",
            "health": 100
          }
        ]

  - id: "webapp-struct-type"
    method: "GET"
    path: "/api/struct/type"
    description: "Get struct types"
    category: "webapp"
    entity: "Struct"
    baseUrl: "${webappBaseUrl}"
    response:
      schema: "schemas/entities.json#/definitions/StructType"
      contentType: "application/json"
    example:
      request: "GET http://localhost:8080/api/struct/type"
      response: |
        [
          {
            "id": 14,
            "name": "Command Ship",
            "cheatsheet_details": "...",
            "cheatsheet_extended_details": "..."
          }
        ]

  - id: "webapp-struct-by-id"
    method: "GET"
    path: "/api/struct/{struct_id}"
    description: "Get struct by ID"
    category: "webapp"
    entity: "Struct"
    baseUrl: "${webappBaseUrl}"
    parameters:
      - name: "struct_id"
        type: "string"
        required: true
        format: "struct-id"
        description: "Struct identifier"
    response:
      schema: "schemas/entities.json#/definitions/Struct"
      contentType: "application/json"
    example:
      request: "GET http://localhost:8080/api/struct/5-1"
      response: |
        {
          "id": "5-1",
          "structTypeId": 14,
          "owner": "1-11",
          "locationId": "2-1",
          "health": 100
        }

---

## Response Schema (v0.8.0-beta Verified)

### Struct Response

**Note**: Destroyed structs are filtered out of responses. The `is_destroyed` field is used in queries (`WHERE s.is_destroyed = false`) but destroyed structs are not returned to clients.

```json
{
  "id": "5-1",
  "structTypeId": 14,
  "owner": "1-11",
  "locationId": "2-1",
  "health": 100,
  "is_building": false
}
```

### Struct Type Response

Struct type responses include cheatsheet fields (verified via `SELECT * FROM struct_type`):

```json
{
  "id": 14,
  "name": "Command Ship",
  "cheatsheet_details": "...",
  "cheatsheet_extended_details": "...",
  ...
}
```

**See**: `reviews/webapp-review-findings.md` for code review verification

---

*Last Updated: January 1, 2026*

