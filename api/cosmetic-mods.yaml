# Cosmetic Sets and Skins API Endpoints

**Version**: 2.0.0  
**Category**: modding  
**Base URL**: ${webappBaseUrl} (default: http://localhost:8080)  
**Purpose**: API for managing cosmetic sets and skins, and querying cosmetic data for Struct Types

---

## Overview

This API allows clients to:
- Install cosmetic mods (converts to Sets/Skins during ingestion)
- Manage cosmetic sets and skins (using hash-based identification)
- Query cosmetic data by struct type class
- Validate mod files before installation
- Integrate cosmetic data with struct type queries

**Note**: This API uses the **Sets/Skins format** with hash-based identification for management endpoints. The install/validate endpoints accept the **mod file format** (which is converted to Sets/Skins during ingestion).

---

## Endpoints

endpoints:
  # Set Management (using hash-based identification)
  - id: "cosmetic-set-list"
    method: "GET"
    path: "/api/cosmetic-sets"
    description: "List all installed cosmetic sets"
    category: "modding"
    parameters:
      - name: "guildId"
        type: "string"
        required: false
        format: "entity-id"
        pattern: "^0-[0-9]+$"
        description: "Filter sets by guild ID"
      - name: "active"
        type: "boolean"
        required: false
        description: "Filter to only active sets (default: true)"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticSetListResponse"
      contentType: "application/json"
    example:
      request: "GET /api/cosmetic-sets?active=true"
      response: |
        {
          "sets": [
            {
              "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
              "name": {"en": "Guild Alpha Mining Set"},
              "version": "1.0.0",
              "author": "Guild Alpha",
              "guildId": "0-1",
              "active": true,
              "classes": ["Miner", "Reactor"],
              "languages": ["en", "es"]
            }
          ]
        }

  - id: "cosmetic-set-get"
    method: "GET"
    path: "/api/cosmetic-sets/{setHash}"
    description: "Get detailed information about a specific cosmetic set"
    category: "modding"
    parameters:
      - name: "setHash"
        type: "string"
        required: true
        pattern: "^[a-f0-9]{64}$"
        description: "Set hash (SHA-256, 64-character hexadecimal)"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticSetResponse"
      contentType: "application/json"
    example:
      request: "GET /api/cosmetic-sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
      response: |
        {
          "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
          "name": {"en": "Guild Alpha Mining Set"},
          "version": "1.0.0",
          "author": "Guild Alpha",
          "guildId": "0-1",
          "active": true,
          "skins": [
            {
              "skinHash": "f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456",
              "class": "Miner",
              "version": "1.0.0"
            }
          ],
          "languages": ["en", "es"]
        }

  - id: "cosmetic-mod-install"
    method: "POST"
    path: "/api/cosmetic-mods/install"
    description: "Install a cosmetic mod (mod file format). Converts to Sets/Skins during ingestion."
    category: "modding"
    note: "This endpoint accepts the mod file format (Phase 1). The mod is converted to Sets/Skins format (Phases 2-4) during ingestion. Response includes setHash/skinHash."
    request:
      schema: "schemas/requests.json#/definitions/CosmeticModInstallRequest"
      contentType: "multipart/form-data"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticModInstallResponse"
      contentType: "application/json"
    example:
      request: |
        POST /api/cosmetic-mods/install
        Content-Type: multipart/form-data
        
        file: [ZIP file or directory path]
        validate: true
      response: |
        {
          "status": "success",
          "type": "set",
          "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
          "version": "1.0.0",
          "skins": [
            {
              "skinHash": "f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456",
              "class": "Miner"
            }
          ],
          "storagePath": "~/.structs/guilds/0-1/cosmetics/sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456/",
          "validated": true
        }

  - id: "cosmetic-set-delete"
    method: "DELETE"
    path: "/api/cosmetic-sets/{setHash}"
    description: "Delete a cosmetic set"
    category: "modding"
    parameters:
      - name: "setHash"
        type: "string"
        required: true
        pattern: "^[a-f0-9]{64}$"
        description: "Set hash (SHA-256, 64-character hexadecimal)"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticSetDeleteResponse"
      contentType: "application/json"
    example:
      request: "DELETE /api/cosmetic-sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
      response: |
        {
          "status": "success",
          "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
        }

  - id: "cosmetic-set-activate"
    method: "POST"
    path: "/api/cosmetic-sets/{setHash}/activate"
    description: "Activate a cosmetic set"
    category: "modding"
    parameters:
      - name: "setHash"
        type: "string"
        required: true
        pattern: "^[a-f0-9]{64}$"
        description: "Set hash (SHA-256, 64-character hexadecimal)"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticSetActivateResponse"
      contentType: "application/json"
    example:
      request: "POST /api/cosmetic-sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456/activate"
      response: |
        {
          "status": "success",
          "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
          "active": true
        }

  - id: "cosmetic-set-deactivate"
    method: "POST"
    path: "/api/cosmetic-sets/{setHash}/deactivate"
    description: "Deactivate a cosmetic set"
    category: "modding"
    parameters:
      - name: "setHash"
        type: "string"
        required: true
        pattern: "^[a-f0-9]{64}$"
        description: "Set hash (SHA-256, 64-character hexadecimal)"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticSetDeactivateResponse"
      contentType: "application/json"
    example:
      request: "POST /api/cosmetic-sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456/deactivate"
      response: |
        {
          "status": "success",
          "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
          "active": false
        }

  - id: "cosmetic-mod-validate"
    method: "POST"
    path: "/api/cosmetic-mods/validate"
    description: "Validate a cosmetic mod file (mod file format) without installing it"
    category: "modding"
    note: "This endpoint accepts the mod file format (Phase 1) and validates it. Does not convert to Sets/Skins."
    request:
      schema: "schemas/requests.json#/definitions/CosmeticModValidateRequest"
      contentType: "multipart/form-data"
    response:
      schema: "schemas/responses.json#/definitions/CosmeticModValidateResponse"
      contentType: "application/json"
    example:
      request: |
        POST /api/cosmetic-mods/validate
        Content-Type: multipart/form-data
        
        file: [ZIP file or directory path]
      response: |
        {
          "valid": true,
          "errors": [],
          "warnings": [
            "Missing fallback language (en) in localizations"
          ],
          "modId": "guild-alpha-miner-v1",
          "version": "1.0.0"
        }

  # Cosmetic Data Queries (by class)
  - id: "cosmetic-class"
    method: "GET"
    path: "/api/cosmetic/class/{class}"
    description: "Get cosmetic data for a struct type class (with skin overrides applied)"
    category: "modding"
    parameters:
      - name: "class"
        type: "string"
        required: true
        description: "Struct type class name (e.g., 'Miner', 'Reactor', 'Command Ship'). Must match struct_type.class field."
      - name: "language"
        type: "string"
        required: false
        default: "en"
        pattern: "^[a-z]{2}$"
        description: "Language code (ISO 639-1, e.g., 'en', 'es')"
      - name: "guildId"
        type: "string"
        required: false
        format: "entity-id"
        pattern: "^0-[0-9]+$"
        description: "Guild ID for guild-specific skins (optional)"
    response:
      schema: "schemas/responses.json#/definitions/StructTypeCosmeticResponse"
      contentType: "application/json"
    example:
      request: "GET /api/cosmetic/class/Miner?language=en&guildId=0-1"
      response: |
        {
          "class": "Miner",
          "skinHash": "f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456",
          "name": "Alpha Extractor",
          "lore": "Guild Alpha's signature mining unit...",
          "weapons": [
            {
              "weaponType": "primary",
              "name": "Plasma Drill",
              "description": "High-powered plasma drilling system"
            }
          ],
          "abilities": [
            {
              "abilityId": "mine",
              "name": "Deep Extraction",
              "description": "Extract resources from planetary deposits"
            }
          ],
          "animations": {
            "idle": "/cosmetics/sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456/skins/f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456/assets/animations/miner-idle.json",
            "active": "/cosmetics/sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456/skins/f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456/assets/animations/miner-mining.json"
          },
          "icon": "/cosmetics/sets/a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456/skins/f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456/assets/icons/miner-alpha.png",
          "skinSource": {
            "skinHash": "f1e2d3c4b5a6789012345678901234567890abcdef1234567890abcdef123456",
            "setHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
            "version": "1.0.0"
          }
        }

  - id: "cosmetic-classes-list"
    method: "GET"
    path: "/api/cosmetic/classes"
    description: "Get cosmetic data for all struct type classes (with skin overrides applied)"
    category: "modding"
    parameters:
      - name: "language"
        type: "string"
        required: false
        default: "en"
        pattern: "^[a-z]{2}$"
        description: "Language code (ISO 639-1)"
      - name: "guildId"
        type: "string"
        required: false
        format: "entity-id"
        pattern: "^0-[0-9]+$"
        description: "Guild ID for guild-specific skins"
    response:
      schema: "schemas/responses.json#/definitions/StructTypeCosmeticListResponse"
      contentType: "application/json"

  # Integration Endpoints
  - id: "struct-type-with-cosmetics"
    method: "GET"
    path: "/api/struct-type/{id}/full"
    description: "Get struct type data with cosmetic overrides applied (integration endpoint)"
    category: "modding"
    parameters:
      - name: "id"
        type: "string"
        required: true
        structs:format: "struct-type-id"
        description: "Struct type ID (for base game data)"
      - name: "class"
        type: "string"
        required: false
        description: "Struct type class name (for cosmetic lookup). If not provided, class is looked up from struct type data."
      - name: "language"
        type: "string"
        required: false
        default: "en"
        pattern: "^[a-z]{2}$"
        description: "Language code for cosmetic text"
      - name: "guildId"
        type: "string"
        required: false
        format: "entity-id"
        pattern: "^0-[0-9]+$"
        description: "Guild ID for guild-specific skins"
    response:
      schema: "schemas/responses.json#/definitions/StructTypeFullResponse"
      contentType: "application/json"
    note: "This endpoint combines struct type game data (from consensus network) with cosmetic skin overrides (from Sets/Skins system). Use this for displaying struct types in the game UI. The class parameter is optional - if not provided, the class is looked up from the struct type's class field."

---

## Integration with Struct Type Queries

### How Skins Integrate

When querying struct types via the Consensus Network API (`/structs/struct_type/{id}`), cosmetic skins are applied by the Web Application API layer:

1. **Query Base Data**: Get struct type from consensus network
2. **Lookup Class**: Get `class` field from struct type
3. **Apply Skin Overrides**: Query cosmetic skins for the class
4. **Merge Data**: Combine base data with cosmetic overrides
5. **Return Result**: Return merged struct type data

### Priority Order

1. **Individual Skin** (highest priority - if standalone skin exists for class)
2. **Set Skin** (if set is active and contains skin for class)
3. **Default game assets** (fallback)

### Example Integration Flow

```
1. GET /structs/struct_type/1-11 (Consensus Network API)
   → Returns base struct type data
   → Includes: { "class": "Miner", "defaultCosmeticName": "Miner" }

2. GET /api/cosmetic/class/Miner?guildId=0-1 (Web Application API)
   → Returns cosmetic skin data for class "Miner"
   → Includes: { "name": "Alpha Extractor", "skinHash": "f1e2d3c4..." }

3. Merge data:
   - Base: { "id": "1-11", "class": "Miner", "defaultCosmeticName": "Miner" }
   - Skin: { "name": "Alpha Extractor", "skinHash": "f1e2d3c4..." }
   - Result: { "id": "1-11", "class": "Miner", "cosmeticName": "Alpha Extractor", "skinHash": "f1e2d3c4..." }
```

**Key Point**: Skins are linked to struct types via the `class` field, not by struct type ID.

---

## Error Codes

See `api/error-codes.yaml` for complete error code reference.

**Mod-Specific Errors**:
- `COSMETIC_MOD_NOT_FOUND` (404): Mod not found
- `COSMETIC_MOD_INVALID` (400): Mod validation failed
- `COSMETIC_MOD_INSTALL_FAILED` (500): Mod installation failed
- `COSMETIC_MOD_CONFLICT` (409): Mod conflicts with existing mod
- `COSMETIC_MOD_UNSUPPORTED_VERSION` (400): Mod version incompatible

---

## Related Documentation

### Mod File Format (Phase 1: Creation)
- **Schema**: `schemas/cosmetic-mod.json` - Mod file schema (input format)
- **User Guide**: `users/modding/cosmetic-mods.md` - Human-readable guide
- **Examples**: `examples/cosmetic-mod-example/` - Example mod files

### Sets/Skins Format (Phases 2-4: System)
- **Set Schema**: `schemas/cosmetic-set.json` - Set schema (system format)
- **Skin Schema**: `schemas/cosmetic-skin.json` - Skin schema (system format)
- **Protocol**: `protocols/cosmetic-mod-protocol.md` - Sets/Skins protocol
- **Hash System**: `technical/cosmetic-hash-system.md` - Hash generation
- **Sets and Skins**: `technical/cosmetic-sets-and-skins.md` - Architecture

### System Architecture
- **Overview**: `technical/cosmetic-system-overview.md` - Four phases
- **Ingestion**: `technical/cosmetic-ingestion.md` - How mods become Sets/Skins
- **Distribution**: `technical/cosmetic-distribution.md` - Peer-to-peer transfer

---

*Last Updated: January 2025*

